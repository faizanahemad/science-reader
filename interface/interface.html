<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.2.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha512-aOG0c6nPNzGk+5zjwyJaoRUgCdOrfSDhmMID2u4+OIslr0GjpLKo7Xm0Ao3xmpM4T8AmIouRkqwj1nrdVsLKEQ==" crossorigin="anonymous" />
<!--     <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script> -->
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.5.0/mermaid.min.js" integrity="sha512-3EZqKCkk3nMLmbrI7mfry81KH7dkzy/BoDfQrodwLQnS/RbsVlERdYP6J0oiJegRUxSOmx7Y35WNbVKSw7mipw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        mermaid.initialize({  
          startOnLoad: true,  
        }); 
    </script>
    
    <!-- mermaid.initialize({ startOnLoad: true }); -->
    <script src="https://laingsimon.github.io/render-diagram/drawio-renderer.js"></script>
    <!-- BULLETPROOF: CodeMirror 5 -->  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldcode.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/indent-fold.min.js"></script>  
      
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.css">  
      
    <script>  
    // CodeMirror 5 - ALWAYS WORKS  
    window.CodeMirror5 = {  
      createEditor: function(parent, doc) {  
        console.log("ðŸš€ Creating bulletproof CodeMirror 5 editor...");  
      
        try {  
          parent.innerHTML = '';  
      
          const textarea = document.createElement('textarea');  
          textarea.value = doc || `# Python Code Editor (CodeMirror 5)  
    def robust_function():  
        """This ALWAYS works - no module conflicts possible"""  
        import os  
        import sys  
        import json  
        from datetime import datetime  
          
        # Complex Python code with full syntax highlighting  
        data = {  
            'platform': sys.platform,  
            'python_version': sys.version,  
            'current_time': datetime.now().isoformat(),  
            'environment': dict(os.environ)  
        }  
          
        # List comprehension  
        squares = [x**2 for x in range(10) if x % 2 == 0]  
          
        # Dictionary comprehension    
        word_lengths = {word: len(word) for word in ['hello', 'world', 'python']}  
          
        # Exception handling  
        try:  
            result = 10 / 0  
        except ZeroDivisionError as e:  
            print(f"Error: {e}")  
            result = None  
          
        print(json.dumps(data, indent=2))  
        return {'squares': squares, 'words': word_lengths, 'result': result}  
      
    # Start your reliable Python coding here...  
    `;  
          parent.appendChild(textarea);  
      
          const editor = CodeMirror.fromTextArea(textarea, {  
            mode: 'python',  
            theme: 'monokai',  
            lineNumbers: true,  
            indentUnit: 4,  
            lineWrapping: true,  
            autoCloseBrackets: true,  
            matchBrackets: true,  
            styleActiveLine: true,  
            foldGutter: true,  
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],  
            extraKeys: {  
              "Tab": function(cm) {  
                if (cm.somethingSelected()) {  
                  cm.indentSelection("add");  
                } else {  
                  cm.replaceSelection("    ");  
                }  
              },  
              "Shift-Tab": function(cm) {  
                cm.indentSelection("subtract");  
              },  
              "Ctrl-/": function(cm) {  
                cm.toggleComment();  
              },
              "Ctrl-F": "findPersistent", // Enable search  
              "Ctrl-H": "replace"      
            }  
          });  
      
          editor.setSize(null, '70vh');  
          editor.getWrapperElement().style.fontSize = '12px';  
      
          console.log("ðŸŽ‰ CodeMirror 5 editor created successfully!");  
          return editor;  
      
        } catch (error) {  
          console.error("ðŸ’¥ Even CodeMirror 5 failed:", error);  
          throw error;  
        }  
      }  
    };  
      
    console.log("âœ… CodeMirror 5 loaded and guaranteed to work");  
    </script>  






    <!-- Include DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.25/datatables.min.css"/>

    <!-- Include DataTables JS -->
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.25/datatables.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$', '$'], ['$$', '$$'], ['\\(', '\\)'], ['\\[', '\\]']],
            displayMath: [['\\[', '\\]'], ['\\(', '\\)'], ['$$', '$$'], ['\[', '\]']],  
            processEscapes: true,
            skipTags: ["code", "pre"],
          }
        });
    </script>

    <!-- Bootstrap CSS -->
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css" integrity="sha512-rt/SrQ4UNIaGfDyEXZtNcyWvQeOq0QLygHluFQcSjaGB04IxWhal71tKuzP6K8eYXYB6vJV4pHkXcmFGGQ1/0w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js" integrity="sha512-igl8WEUuas9k5dtnhKqyyld6TzzRjvMqLC79jkgT3z02FvJyHAuUtyemm/P/jYSne1xwFI06ezQxEwweaiV7VA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="interface/style.css">

    <title>Document Index Interface</title>
</head>
<body>
    
    <div id="loader">
      <h1>
        <div class="d-flex justify-content-center">
          <div class="spinner-border spinner-border-loader text-success" role="status">
            <span class="sr-only">Page will be loaded in 5 seconds on fast wifi connections ... </span>
          </div>
        </div>
      </h1>

    </div>
    <div class="container-fluid">
        <div class="row scrolling-row">
          <ul class="nav nav-tabs" id="pdf-details-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link" id="show-sidebar" href="#"><i class="fa fa-bars"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" id="hide-navbar" href="#">Show only PDF</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" id="assistant-tab" href="#assistant-view" data-toggle="tab" role="tab">Assistant</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" id="search-tab" href="#search-view" data-toggle="tab" role="tab">Search</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="finchat-tab" href="#finchat-view" data-toggle="tab" role="tab">Prep-Chat</a>
            </li>
            
            
            
            
            <li class="nav-item ml-auto">
                <a class="nav-link" id="logout-link" href="#">
                    <span class="logout-text">Logout</span>
                    <span class="username" id="username" style="display: none;">Logged in as <span id="username">Loading...</span></span>
                </a>
            </li>
          </ul>
          <div id="navbar-trigger" style="height: 5px;"></div>
        </div>
        <div id="chat-pdf-content" style="height: calc(100% - 30px);" class="d-none row scrolling-row">
          <!-- Add a close button to the side of iframe -->
          <iframe id="pdfjs-viewer" src="interface/pdf.js/web/viewer.html" data-original-src="interface/pdf.js/web/viewer.html" width="100%" height="100%" allowfullscreen webkitallowfullscreen></iframe>
          <!-- PDF will be displayed here -->
          <div id="progress" style="display: none;">
              <div id="progressbar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
          </div>
          <span id="progress-status"></span>
        </div>
        <div id="chat-content" class="row scrolling-row" style="height: calc(100% - 30px); max-height: calc(100vh - 30px);">
            

            <div class="col-md-10" id="content-col">
                
                
                <div id="chat-assistant-view" class="container-fluid" style="padding-left: 2px; padding-top: 2px;">
                  <div class="tab-content">
                    <div class="tab-pane fade show active" id="assistant-view" role="tabpanel" style="height: calc(100vh - 55px) !important;">
                      <div class="row scrolling-row">
                        <div class="col-md-2 sidebar sticky-top scrollable-sidebar" id="chat-assistant-sidebar" style="height: calc(100vh - 55px) !important;">
                            <!-- Sidebar -->
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <h5 class="mb-0">Chats</h5>
                                <div class="btn-group">
                                    <button id="add-new-chat" type="button" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i></button>
                                    <button id="add-new-workspace" type="button" class="btn btn-secondary btn-sm" title="New Workspace"><i class="fa fa-folder-plus"></i></button>
                                </div>
                            </div>
                            
                            <!-- Workspace Container -->
                            <div id="workspaces-container" style="margin-top: 10px;">
                                <!-- Workspaces will be dynamically populated here -->
                            </div>
                            
                            <!-- Context Menu for Workspaces -->
                            <div id="workspace-context-menu" class="context-menu" style="display: none;">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#" id="rename-workspace"><i class="fa fa-edit"></i> Rename</a></li>
                                    <li><a href="#" id="delete-workspace"><i class="fa fa-trash"></i> Delete</a></li>
                                    <li><a href="#" id="change-workspace-color"><i class="fa fa-palette"></i> Change Color</a></li>
                                </ul>
                            </div>
                            
                            <!-- Context Menu for Conversations -->
                            <div id="conversation-context-menu" class="context-menu" style="display: none;">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#" id="move-to-workspace"><i class="fa fa-folder"></i> Move to Workspace</a></li>
                                    <li class="dropdown-submenu">
                                        <a href="#" class="dropdown-toggle"><i class="fa fa-folder-open"></i> Move to...</a>
                                        <ul id="workspace-submenu" class="dropdown-menu">
                                            <!-- Workspace options will be populated here -->
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-10" id="chat-assistant" style="height: calc(100vh - 55px) !important;">
                          <div id="mainView" class="container-fluid d-flex flex-column vh-100" style="height: calc(100vh - 55px) !important;">
                              <div class="row d-md-none">
                                  <button id="toggleChatDocsView" class="btn btn-secondary btn-xs rounded-pill d-md-none">
                                    â–¼
                                  </button>
                              </div>
                              <div id="chat-doc-view" class="row d-none d-md-flex">
                                  <!-- Chat Docs will be populated here -->
                                  <button id="get-chat-transcript" type="button" class="btn btn-primary mr-2 btn-sm mb-1"><i class="fa fa-download">&nbsp;</i></button>
                                  <button id="share-chat" type="button" class="btn btn-primary mr-2 btn-sm mb-1"><i class="fa fa-share-alt">&nbsp;</i></button>
                                  <button id="add-document-button-chat" type="button" class="btn btn-primary mr-2 btn-sm mb-1"><i class="fa fa-plus">&nbsp; Add Doc</i></button>

                              </div>
                              <div id="chatView" class="row flex-grow-1 overflow-auto">
                                  <!-- Chat messages will be dynamically populated here -->
                              </div>
                              <button id="scrollToBottomBtn" class="btn btn-sm btn-primary" style="opacity: 0.8; display:none; position: fixed; bottom: 80px;left: 50%;transform: translateX(-50%); z-index: 100;">â–¼</button>
                              <div id="chat-controls">
                                <div class="row mb-1"> <!-- Reduced margin bottom -->
                                    
                                    <div class="input-group" style="width: calc(100% - 90px);">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="chat-file-upload-span" style="border-right: none; background-color: transparent;">
                                                <label for="chat-file-upload" class="mb-0" style="cursor: pointer;">
                                                    <i class="fa fa-paperclip"></i> <!-- Paperclip icon -->
                                                </label>
                                                <input id="chat-file-upload" type="file" accept="application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, text/plain, image/jpeg, image/png, image/svg+xml, image/bmp, application/rtf, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, text/tab-separated-values, application/parquet, application/x-jsonlines, application/json, application/x-ndjson" style="display: none;"/>
                                            </span>
                                            <span class="input-group-text" id="voice-record-span" style="border-right: none; background-color: transparent;">  
                                                <label for="voice-record" class="mb-0" style="cursor: pointer;">  
                                                    <i class="fa fa-microphone"></i>  
                                                </label>  
                                                <button id="voice-record" style="display: none;"></button>  
                                            </span>  
                                        </div>
                                        <textarea id="messageText" class="dynamic-textarea form-control" placeholder="Type your message here." style="max-height: 240px; overflow-y: auto; height: 38px; border-left: none;"></textarea>
                                    </div>
                                    
                                    <div class="input-group-append" style="margin-left: 5px;">
                                        <button id="sendMessageButton" class="btn btn-success">
                                            âž¤<!-- i class="fas fa-paper-plane"></i--> <!-- You can also add "Send" text here if needed -->
                                        </button>
                                         <div id="uploadProgressContainer" style="position: relative; display: inline-block; display: none;">
                                              <div id="uploadSpinner" class="spinner-border text-success" role="status">
                                                  <span class="sr-only">Uploading...</span>
                                              </div>
                                              <div id="uploadProgressText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold;">
                                                  0%
                                              </div>
                                          </div>
                                    </div>
                                    <div class="input-group-append" style="margin-right: -25px;margin-left: 5px;">
                                      <button id="toggleChatControls" class="btn btn-secondary rounded-pill">â–²</button>
                                    </div>
                                </div>
                                
                                <div class="row mb-1 d-none" id="chat-search-links-input"> <!-- Reduced margin bottom -->
                                    <div class="col p-0" style="padding-right: 10px !important;"> <!-- Removed padding -->
                                        <textarea id="linkInput" class="dynamic-textarea form-control" placeholder="Links to Visit, each in a new line"></textarea>
                                    </div>
                                    <div class="col p-0"> <!-- Removed padding -->
                                        <textarea id="searchInput" class="dynamic-textarea form-control" placeholder="Search Phrases, each in a new line"></textarea>
                                    </div>
                                </div>
                                <div id="chat-options" class="mt-0 mb-0 d-none container-fluid"> <!-- Removed top and bottom margin -->
                                    
                                </div>
                              </div>
                          </div>
                        </div>
                      
                      
                      
                      
                      </div>
                    </div>
                  </div>
                </div>

                
                
            </div>
        </div>
        
    </div>

    

    <!-- Add Chat Document Modal -->
    <div class="modal" tabindex="-1" id="add-document-modal-chat">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Document</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="add-document-form">
                      <div class="form-group">
                        <label for="pdf-url">PDF URL (Note: Indexing takes long time (~2 minute).)</label>
                        <input type="text" class="form-control" id="pdf-url" placeholder="Enter PDF URL">
                        <label>Or drop a PDF file here or<button type="button" id="file-upload-button" style="padding-left: 4px; padding-top:2px;" class="btn btn-link">browse</button></label>
                        <div id="drop-area" style="border: 2px dashed #aaa; padding: 10px; text-align: center;">
                          Drop a PDF file here. To upload MS Word or html, first convert them to PDF.
                        </div>
                        <input type="file" class="form-control-file" id="pdf-file" accept="application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, text/plain, image/jpeg, image/png, image/svg+xml, image/bmp, application/rtf, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, text/tab-separated-values, application/parquet, application/x-jsonlines, application/json, application/x-ndjson" style="display: none;">  
                      </div>
                      
                        <button id="submit-button" type="submit" class="btn btn-primary">Submit</button>
                        <div id="submit-spinner" style="display: none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Make conversation stateless Modal -->
    <div class="modal fade" id="stateless-conversation-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Conversation Now Stateless</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            The conversation is now stateless. It will be deleted when you refresh the page. In case you want to save the conversation and revisit it later, please click on the "eye" button again.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="$('#stateless-conversation-modal').modal('hide');">Ok</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Make conversation stateful Modal -->
    <div class="modal fade" id="stateful-conversation-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Conversation Stateful</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            The conversation is now Stateful again.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="$('#stateful-conversation-modal').modal('hide');">Ok</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Memory Pad Modal -->
    <div class="modal fade" id="memory-pad-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Memory Pad</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <textarea id="memory-pad-text" class="form-control" rows="10"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" id="memory-pad-text-save-button" class="btn btn-primary" onclick="$('#memory-pad-modal').modal('hide');">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Details Modal -->
    <div class="modal fade" id="user-details-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">User Details</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <textarea id="user-details-text" class="form-control" rows="10"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" id="user-details-text-save-button" class="btn btn-primary" onclick="$('#user-details-modal').modal('hide');">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Preferences Modal -->
    <div class="modal fade" id="user-preferences-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">User Preferences</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <textarea id="user-preferences-text" class="form-control" rows="10"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" id="user-preferences-text-save-button" class="btn btn-primary" onclick="$('#user-preferences-modal').modal('hide');">Save</button>
          </div>
        </div>
      </div>
    </div>



    <!-- Message Edit Modal -->
    <div class="modal fade" id="message-edit-modal" tabindex="-1" aria-hidden="true">  
      <div class="modal-dialog modal-lg"> <!-- Changed to modal-lg for a larger modal -->  
        <div class="modal-content">  
          <div class="modal-header">  
            <h5 class="modal-title">Edit Message</h5>  
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
              <span aria-hidden="true">&times;</span>  
            </button>  
          </div>  
          <div class="modal-body">  
            <textarea id="message-edit-text" class="form-control" rows="15"></textarea> <!-- Increased rows to 15 -->  
          </div>  
          <div class="modal-footer">  
            <button type="button" id="message-edit-text-save-button" class="btn btn-primary" onclick="$('#message-edit-modal').modal('hide');">Save</button>  
          </div>  
        </div>  
      </div>  
    </div>  

    <!-- Copied to clipboard -->
    <div class="modal fade" id="clipboard-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Copied.</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Copied to Clipboard.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="$('#clipboard-modal').modal('hide');">Ok</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Prevent Rendering Modal -->
    <div class="modal fade" id="prevent-chat-rendering" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            You cannot send a message while the previous message is still rendering. Please wait...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Coding Hint Modal -->
    <div id="hint-modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-lg" style="max-width: 800px;">
            <div class="modal-content" style="border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                <div class="modal-header" style="border-bottom: 1px solid #ddd;">
                    <h5 class="modal-title" style="color: #333;">
                        <i class="bi bi-lightbulb"></i>&nbsp;ðŸ’¡ Coding Hint
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: #aaa; font-size: 28px; font-weight: bold; line-height: 1;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                    <div id="hint-status" class="mb-2" style="display: none;">
                        <div class="d-flex align-items-center">
                            <div class="spinner-border spinner-border-sm text-primary mr-2" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <small class="text-muted" id="hint-status-text">Generating hint...</small>
                        </div>
                    </div>
                    <div id="hint-content">
                        <!-- Hint content will be populated here -->
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #ddd;">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="bi bi-x-circle"></i>&nbsp;Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Full Solution Modal -->
    <div id="solution-modal" class="modal fade" tabindex="-1" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-xl" style="max-width: 900px;">
            <div class="modal-content" style="border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                <div class="modal-header" style="border-bottom: 1px solid #ddd;">
                    <h5 class="modal-title" style="color: #333;">
                        <i class="bi bi-lightbulb-fill"></i>&nbsp;ðŸŽ¯ Complete Solution
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: #aaa; font-size: 28px; font-weight: bold; line-height: 1;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                    <div id="solution-status" class="mb-2" style="display: none;">
                        <div class="d-flex align-items-center">
                            <div class="spinner-border spinner-border-sm text-primary mr-2" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <small class="text-muted" id="solution-status-text">Generating solution...</small>
                        </div>
                    </div>
                    <div id="solution-content">
                        <!-- Solution content will be populated here -->
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #ddd;">
                    <button type="button" id="copy-solution-btn" class="btn btn-primary" style="margin-right: 8px;">
                        <i class="bi bi-clipboard"></i>&nbsp;Copy to Editor
                    </button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="bi bi-x-circle"></i>&nbsp;Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Code Editor Modal -->  
    <div class="modal fade" id="code-editor-modal" tabindex="-1" aria-hidden="true">  
      <div class="modal-dialog modal-xl"> <!-- Using modal-xl for more space -->  
        <div class="modal-content">  
          <div class="modal-header">  
            <h5 class="modal-title">  
              <i class="bi bi-code-slash"></i>&nbsp;Python Code Editor  
            </h5>  
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
              <span aria-hidden="true">&times;</span>  
            </button>  
          </div>  
          <div class="modal-body p-0"> <!-- Remove padding for full editor space -->  
            <!-- Toolbar for copy/paste actions -->  
            <div class="border-bottom p-2 bg-light">  
              <div class="btn-group" role="group">  
                <button type="button" id="copy-code-button" class="btn btn-sm btn-outline-primary">  
                  <i class="bi bi-clipboard"></i>&nbsp;Copy Code  
                </button> 
              </div>
              <div class="btn-group" role="group">  

                <button type="button" id="hint-code-button" class="btn btn-sm btn-outline-info">  
                  <i class="bi bi-lightbulb-fill"></i></i>&nbsp;Hint  
                </button> 
              </div>
              <div class="btn-group" role="group">  
                <button type="button" id="full-solution-code-button" class="btn btn-sm btn-outline-warning">  
                  <i class="bi bi-magic"></i></i>&nbsp;<b>Full Solution</b>  
                </button> 
              </div>
              <div class="btn-group" role="group">  
                 
                <button type="button" id="clear-code-button" class="btn btn-sm btn-outline-danger">  
                  <i class="bi bi-trash"></i>&nbsp;Clear  
                </button>  
              </div>  
              <div class="btn-group float-right" role="group">  
                <button type="button" id="format-code-button" class="btn btn-sm btn-outline-info">  
                  <i class="bi bi-magic"></i>&nbsp;Format  
                </button>  
              </div>  
            </div>  
            <!-- CodeMirror Editor Container -->  
          <div id="python-code-editor" style="height: 70vh; border: none;"></div>  
          </div>  
          <div class="modal-footer">  
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>  
            <button type="button" id="save-code-button" class="btn btn-primary">  
              <i class="bi bi-check-lg"></i>&nbsp;Save Code  
            </button>  

            <button type="button" id="run-code-button" class="btn btn-success">  
              <i class="bi bi-play-fill"></i>&nbsp;Run Code  
            </button>  
          </div>  
        </div>  
      </div>  
    </div>  


    <!-- Code Execution Results Modal -->  
    <!-- Code Execution Results Modal - Scrollable Version -->  
    <div class="modal fade" id="code-results-modal" tabindex="-1" aria-hidden="true">  
      <div class="modal-dialog modal-lg" style="max-width: 90vw; height: 80vh; margin: 10vh auto;">  
        <div class="modal-content" style="height: 100%; display: flex; flex-direction: column;">  
          <div class="modal-header" style="flex-shrink: 0;">  
            <h5 class="modal-title">  
              <i class="bi bi-terminal"></i>&nbsp;Code Execution Results  
            </h5>  
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
              <span aria-hidden="true">&times;</span>  
            </button>  
          </div>  
            
          <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 1rem;">  
            <!-- Loading state -->  
            <div id="results-loading" class="text-center py-4">  
              <div class="spinner-border text-primary" role="status">  
                <span class="sr-only">Executing code...</span>  
              </div>  
              <p class="mt-2 text-muted">Executing your Python code...</p>  
            </div>  
      
            <!-- Results content (hidden initially) - This div will scroll -->  
            <div id="results-content" class="d-none" style="max-height: none; word-wrap: break-word; white-space: pre-wrap;">  
              <!-- This div will contain the markdown-rendered results -->  
            </div>  
      
            <!-- Error state (hidden initially) -->  
            <div id="results-error" class="d-none">  
              <div class="alert alert-danger">  
                <h6><i class="bi bi-exclamation-triangle"></i> Execution Error</h6>  
                <pre id="error-details" class="mb-0" style="white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto;"></pre>  
              </div>  
            </div>  
          </div>  
            
          <div class="modal-footer" style="flex-shrink: 0;">  
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>  
            <button type="button" id="copy-results-button" class="btn btn-outline-primary">  
              <i class="bi bi-clipboard"></i>&nbsp;Copy Results  
            </button>  
          </div>  
        </div>  
      </div>  
    </div>  






    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="interface/parseMessageForCheckBoxes.js"></script>
    <script src="interface/common.js"></script>
    <script src="interface/common-chat.js"></script>
    <script src="interface/interface.js"></script>
    <script src="interface/codemirror.js"></script>
    <script src="interface/chat.js"></script>
    <!-- Add to the <head> section -->
    <link rel="stylesheet" href="interface/workspace-styles.css">

    <!-- Add before closing </body> tag -->
    <script src="interface/workspace-manager.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
    <script>
      function addDarkmodeWidget() {
        new Darkmode({
          bottom: 'unset', // default: '32px'
          right: '32px', // default: '32px'
          left: 'unset', // default: 'unset'
          time: '0.5s', // default: '0.3s'
          mixColor: '#fff', // default: '#fff'
          backgroundColor: '#fff',  // default: '#fff'
          buttonColorDark: '#100f2c',  // default: '#100f2c'
          buttonColorLight: '#fff', // default: '#fff'
          saveInCookies: false, // default: true,
          label: 'ðŸŒ“', // default: ''
          autoMatchOsTheme: true // default: true
        }).showWidget();
      }
      window.addEventListener('load', addDarkmodeWidget);
    </script>
    <script src="interface/audio_process.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$', '$'], ['$$', '$$'], ['\\(', '\\)'], ['\\[', '\\]']],
          displayMath: [['\\[', '\\]'], ['\\(', '\\)'], ['$$', '$$'], ['\[', '\]']],  
          processEscapes: true,
          skipTags: ["code", "pre"],
        }
      });
  </script>
  <style>
    .details-close-btn {
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 5px 10px;
        font-size: 12px;
        cursor: pointer;
        margin-top: 10px;
        display: inline-block;
    }
    .details-close-btn:hover {
        background-color: #e0e0e0;
    }

    /* Custom styling for hint and solution modals */
    #hint-modal, #solution-modal {
        z-index: 1060 !important; /* Above code editor modal */
    }
    
    #hint-modal .modal-content, #solution-modal .modal-content {
        border: none;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    #hint-modal .modal-header, #solution-modal .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-bottom: none;
    }
    
    #hint-modal .modal-title, #solution-modal .modal-title {
        color: white !important;
        font-weight: 600;
    }
    
    #hint-modal .close, #solution-modal .close {
        color: white !important;
        opacity: 0.8;
        transition: opacity 0.2s;
    }
    
    #hint-modal .close:hover, #solution-modal .close:hover {
        opacity: 1;
        color: white !important;
    }
    
    #hint-content, #solution-content {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
    }
    
    #hint-content pre, #solution-content pre {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 1rem;
        overflow-x: auto;
    }
    
    #hint-content code, #solution-content code {
        background-color: #f8f9fa;
        color: #e83e8c;
        padding: 2px 4px;
        border-radius: 3px;
        font-size: 0.9em;
    }
    
    #copy-solution-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        transition: all 0.2s;
    }
    
    #copy-solution-btn:hover {
        background: linear-gradient(135deg, #218838 0%, #1da589 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    </style>
    <script>
    document.addEventListener('click', function(event) {
        if (event.target.classList.contains('details-close-btn')) {
            // Find the parent details element
            let details = event.target.closest('details');
            if (details) {
                // Close the details element
                details.removeAttribute('open');
                // Scroll to the summary
                details.querySelector('summary').scrollIntoView({behavior: 'smooth'});
            }
        }
    });
    </script>
</body>
</html>
