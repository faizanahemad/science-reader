<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.2.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha512-aOG0c6nPNzGk+5zjwyJaoRUgCdOrfSDhmMID2u4+OIslr0GjpLKo7Xm0Ao3xmpM4T8AmIouRkqwj1nrdVsLKEQ==" crossorigin="anonymous" />
<!--     <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script> -->
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js" integrity="sha512-gx05X612uoaolzJ5Ee/786b3th+qzAm90TOvRwZJwnE8yr0sHQG8eLxdR0/Hbqc2IFh2mWHzzXk79g3atNSwsQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        mermaid.initialize({startOnLoad:true});
    </script>
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      <!-- mermaid.initialize({ startOnLoad: true }); -->
    </script>
    <script src="https://laingsimon.github.io/render-diagram/drawio-renderer.js"></script>




    <!-- Include DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.25/datatables.min.css"/>

    <!-- Include DataTables JS -->
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.25/datatables.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$', '$'], ['$$', '$$'], ['\\(', '\\)']],
            displayMath: [['\\[', '\\]']],  
            processEscapes: true,
            skipTags: ["code", "pre"],
          }
        });
    </script>

    <!-- Bootstrap CSS -->
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css" integrity="sha512-rt/SrQ4UNIaGfDyEXZtNcyWvQeOq0QLygHluFQcSjaGB04IxWhal71tKuzP6K8eYXYB6vJV4pHkXcmFGGQ1/0w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js" integrity="sha512-igl8WEUuas9k5dtnhKqyyld6TzzRjvMqLC79jkgT3z02FvJyHAuUtyemm/P/jYSne1xwFI06ezQxEwweaiV7VA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="interface/style.css">

    <title>Document Index Interface</title>
</head>
<body>
    
    <div id="loader">
      <h1>
        <div class="d-flex justify-content-center">
          <div class="spinner-border spinner-border-loader text-success" role="status">
            <span class="sr-only">Page will be loaded in 5 seconds on fast wifi connections ... </span>
          </div>
        </div>
      </h1>

    </div>
    <div class="container-fluid">
        <div class="row scrolling-row">
          <ul class="nav nav-tabs" id="pdf-details-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link" id="show-sidebar" href="#"><i class="fa fa-bars"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" id="hide-navbar" href="#">Show only PDF</a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" id="assistant-tab" href="#assistant-view" data-toggle="tab" role="tab">Assistant</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" id="search-tab" href="#search-view" data-toggle="tab" role="tab">Search</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="finchat-tab" href="#finchat-view" data-toggle="tab" role="tab">Fin-Chat</a>
            </li>
            
            
            
            
            <li class="nav-item ml-auto">
                <a class="nav-link" id="logout-link" href="#">
                    <span class="logout-text">Logout</span>
                    <span class="username" id="username" style="display: none;">Logged in as <span id="username">Loading...</span></span>
                </a>
            </li>
          </ul>
          <div id="navbar-trigger" style="height: 5px;"></div>
        </div>
        <div id="chat-pdf-content" style="height: calc(100% - 30px);" class="d-none row scrolling-row">
          <!-- Add a close button to the side of iframe -->
          <iframe id="pdfjs-viewer" src="interface/pdf.js/web/viewer.html" data-original-src="interface/pdf.js/web/viewer.html" width="100%" height="100%" allowfullscreen webkitallowfullscreen></iframe>
          <!-- PDF will be displayed here -->
          <div id="progress" style="display: none;">
              <div id="progressbar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
          </div>
          <span id="progress-status"></span>
        </div>
        <div id="chat-content" class="row scrolling-row" style="height: calc(100% - 30px); max-height: calc(100vh - 30px);">
            

            <div class="col-md-10" id="content-col">
                
                
                <div id="chat-assistant-view" class="container-fluid" style="padding-left: 2px; padding-top: 2px;">
                  <div class="tab-content">
                    <div class="tab-pane fade show active" id="assistant-view" role="tabpanel">
                      <div class="row scrolling-row" style="height: calc(100vh - 55px) !important;">
                        <div class="col-md-2 sidebar sticky-top scrollable-sidebar" id="chat-assistant-sidebar" style="height: calc(100vh - 55px) !important;">
                            <!-- Sidebar -->
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <h5 class="mb-0">Chats</h5> <!-- Added class mb-0 to remove default bottom margin -->
                                <button id="add-new-chat" type="button" class="btn btn-primary ml-2 btn-sm"><i class="fa fa-plus">&nbsp;Chat</i></button>
                            </div>
                            <div id="conversations" class="list-group" style="margin-top: 10px;">
                                <!-- Conversations will be dynamically populated here -->
                            </div>
                        </div>
                        <div class="col-md-10" id="chat-assistant" style="height: calc(100vh - 55px) !important;">
                          <div id="mainView" class="container-fluid d-flex flex-column vh-100" style="height: calc(100vh - 55px) !important;">
                              <div class="row d-md-none">
                                  <button id="toggleChatDocsView" class="btn btn-secondary btn-xs rounded-pill d-md-none">
                                    â–¼
                                  </button>
                              </div>
                              <div id="chat-doc-view" class="row d-none d-md-flex">
                                  <!-- Chat Docs will be populated here -->
                                  <button id="get-chat-transcript" type="button" class="btn btn-primary mr-2 btn-sm mb-1"><i class="fa fa-download">&nbsp;</i></button>
                                  <button id="share-chat" type="button" class="btn btn-primary mr-2 btn-sm mb-1"><i class="fa fa-share-alt">&nbsp;</i></button>
                                  <button id="add-document-button-chat" type="button" class="btn btn-primary mr-2 btn-sm mb-1"><i class="fa fa-plus">&nbsp; Add Doc</i></button>

                              </div>
                              <div id="chatView" class="row flex-grow-1 overflow-auto">
                                  <!-- Chat messages will be dynamically populated here -->
                              </div>
                              <button id="scrollToBottomBtn" class="btn btn-sm btn-primary" style="opacity: 0.8; display:none; position: fixed; bottom: 80px;left: 50%;transform: translateX(-50%); z-index: 100;">â–¼</button>
                              <div id="chat-controls">
                                <div class="row mb-1"> <!-- Reduced margin bottom -->
                                    
                                    <div class="input-group" style="width: calc(100% - 90px);">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="chat-file-upload-span" style="border-right: none; background-color: transparent;">
                                                <label for="chat-file-upload" class="mb-0" style="cursor: pointer;">
                                                    <i class="fas fa-paperclip"></i> <!-- Paperclip icon -->
                                                </label>
                                                <input id="chat-file-upload" type="file" accept="application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, text/plain, image/jpeg, image/png, image/svg+xml, image/bmp, application/rtf, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, text/tab-separated-values, application/parquet, application/x-jsonlines, application/json, application/x-ndjson" style="display: none;"/>
                                            </span>
                                            <span class="input-group-text" id="voice-record-span" style="border-right: none; background-color: transparent;">  
                                                <label for="voice-record" class="mb-0" style="cursor: pointer;">  
                                                    <i class="fas fa-microphone"></i>  
                                                </label>  
                                                <button id="voice-record" style="display: none;"></button>  
                                            </span>  
                                        </div>
                                        <textarea id="messageText" class="dynamic-textarea form-control" placeholder="Type your message here." style="max-height: 240px; overflow-y: auto; height: 38px; border-left: none;"></textarea>
                                    </div>
                                    
                                    <div class="input-group-append" style="margin-left: 5px;">
                                        <button id="sendMessageButton" class="btn btn-success">
                                            âž¤<!-- i class="fas fa-paper-plane"></i--> <!-- You can also add "Send" text here if needed -->
                                        </button>
                                         <div id="uploadProgressContainer" style="position: relative; display: inline-block; display: none;">
                                              <div id="uploadSpinner" class="spinner-border text-success" role="status">
                                                  <span class="sr-only">Uploading...</span>
                                              </div>
                                              <div id="uploadProgressText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold;">
                                                  0%
                                              </div>
                                          </div>
                                    </div>
                                    <div class="input-group-append" style="margin-right: -25px;margin-left: 5px;">
                                      <button id="toggleChatControls" class="btn btn-secondary rounded-pill">â–²</button>
                                    </div>
                                </div>
                                
                                <div class="row mb-1 d-none" id="chat-search-links-input"> <!-- Reduced margin bottom -->
                                    <div class="col p-0" style="padding-right: 10px !important;"> <!-- Removed padding -->
                                        <textarea id="linkInput" class="dynamic-textarea form-control" placeholder="Links to Visit, each in a new line"></textarea>
                                    </div>
                                    <div class="col p-0"> <!-- Removed padding -->
                                        <textarea id="searchInput" class="dynamic-textarea form-control" placeholder="Search Phrases, each in a new line"></textarea>
                                    </div>
                                </div>
                                <div id="chat-options" class="mt-0 mb-0 d-none container-fluid"> <!-- Removed top and bottom margin -->
                                    
                                </div>
                              </div>
                          </div>
                        </div>
                      
                      
                      
                      
                      </div>
                    </div>
                  </div>
                </div>

                
                
            </div>
        </div>
        
    </div>

    

    <!-- Add Chat Document Modal -->
    <div class="modal" tabindex="-1" id="add-document-modal-chat">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Document</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="add-document-form">
                      <div class="form-group">
                        <label for="pdf-url">PDF URL (Note: Indexing takes long time (~2 minute).)</label>
                        <input type="text" class="form-control" id="pdf-url" placeholder="Enter PDF URL">
                        <label>Or drop a PDF file here or<button type="button" id="file-upload-button" style="padding-left: 4px; padding-top:2px;" class="btn btn-link">browse</button></label>
                        <div id="drop-area" style="border: 2px dashed #aaa; padding: 10px; text-align: center;">
                          Drop a PDF file here. To upload MS Word or html, first convert them to PDF.
                        </div>
                        <input type="file" class="form-control-file" id="pdf-file" accept="application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, text/plain, image/jpeg, image/png, image/svg+xml, image/bmp, application/rtf, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, text/tab-separated-values, application/parquet, application/x-jsonlines, application/json, application/x-ndjson" style="display: none;">  
                      </div>
                      
                        <button id="submit-button" type="submit" class="btn btn-primary">Submit</button>
                        <div id="submit-spinner" style="display: none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Make conversation stateless Modal -->
    <div class="modal fade" id="stateless-conversation-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Conversation Now Stateless</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            The conversation is now stateless. It will be deleted when you refresh the page. In case you want to save the conversation and revisit it later, please click on the "eye" button again.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="$('#stateless-conversation-modal').modal('hide');">Ok</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Make conversation stateful Modal -->
    <div class="modal fade" id="stateful-conversation-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Conversation Stateful</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            The conversation is now Stateful again.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="$('#stateful-conversation-modal').modal('hide');">Ok</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Memory Pad Modal -->
    <div class="modal fade" id="memory-pad-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Memory Pad</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <textarea id="memory-pad-text" class="form-control" rows="10"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" id="memory-pad-text-save-button" class="btn btn-primary" onclick="$('#memory-pad-modal').modal('hide');">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Message Edit Modal -->
    <div class="modal fade" id="message-edit-modal" tabindex="-1" aria-hidden="true">  
      <div class="modal-dialog modal-lg"> <!-- Changed to modal-lg for a larger modal -->  
        <div class="modal-content">  
          <div class="modal-header">  
            <h5 class="modal-title">Edit Message</h5>  
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">  
              <span aria-hidden="true">&times;</span>  
            </button>  
          </div>  
          <div class="modal-body">  
            <textarea id="message-edit-text" class="form-control" rows="15"></textarea> <!-- Increased rows to 15 -->  
          </div>  
          <div class="modal-footer">  
            <button type="button" id="message-edit-text-save-button" class="btn btn-primary" onclick="$('#message-edit-modal').modal('hide');">Save</button>  
          </div>  
        </div>  
      </div>  
    </div>  

    <!-- Copied to clipboard -->
    <div class="modal fade" id="clipboard-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Copied.</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Copied to Clipboard.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="$('#clipboard-modal').modal('hide');">Ok</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Prevent Rendering Modal -->
    <div class="modal fade" id="prevent-chat-rendering" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            You cannot send a message while the previous message is still rendering. Please wait...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="interface/parseMessageForCheckBoxes.js"></script>
    <script src="interface/common.js"></script>
    <script src="interface/common-chat.js"></script>
    <script src="interface/interface.js"></script>
    <script src="interface/chat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
    <script>
      function addDarkmodeWidget() {
        new Darkmode({
          bottom: 'unset', // default: '32px'
          right: '32px', // default: '32px'
          left: 'unset', // default: 'unset'
          time: '0.5s', // default: '0.3s'
          mixColor: '#fff', // default: '#fff'
          backgroundColor: '#fff',  // default: '#fff'
          buttonColorDark: '#100f2c',  // default: '#100f2c'
          buttonColorLight: '#fff', // default: '#fff'
          saveInCookies: false, // default: true,
          label: 'ðŸŒ“', // default: ''
          autoMatchOsTheme: true // default: true
        }).showWidget();
      }
      window.addEventListener('load', addDarkmodeWidget);
    </script>
    <script src="interface/audio_process.js"></script>
</body>
</html>
