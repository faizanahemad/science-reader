<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant</title>
    <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
    <!-- Screen 1: Server selection (shown first) -->
    <div id="connect-screen">
        <div class="connect-header">
            <div class="connect-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="3"/>
                    <line x1="15" y1="3" x2="15" y2="21"/>
                </svg>
            </div>
            <h2>AI Assistant</h2>
            <p class="connect-subtitle">Choose a server to connect</p>
        </div>

        <div class="connect-presets">
            <button class="preset-btn" data-url="http://localhost:5000">
                <span class="preset-label">Use Local</span>
                <span class="preset-url">localhost:5000</span>
            </button>
            <button class="preset-btn" data-url="https://assist-chat.site">
                <span class="preset-label">Use Hosted</span>
                <span class="preset-url">assist-chat.site</span>
            </button>
        </div>

        <div class="connect-custom">
            <label for="custom-url">Or enter a custom URL</label>
            <div class="custom-url-row">
                <input type="url" id="custom-url" placeholder="https://your-server.com">
                <button id="connect-btn">Connect</button>
            </div>
        </div>

        <p id="connect-error" class="connect-error" style="display:none;"></p>
    </div>

    <!-- Screen 2: Loading spinner -->
    <div id="loading" style="display:none;">
        <div class="spinner"></div>
        <p>Connecting to <span id="loading-url"></span>...</p>
    </div>

    <!-- Screen 3: Main UI iframe (no src until user connects) -->
    <iframe id="main-ui-frame"
            allow="microphone; clipboard-write"
            sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-downloads">
    </iframe>

    <!-- Screen 4: Connection error -->
    <div id="error" style="display:none;">
        <h3>Cannot connect</h3>
        <p>Could not reach the server at:</p>
        <code id="error-url"></code>
        <div class="error-actions">
            <button id="retry-btn">Retry</button>
            <button id="change-server-btn">Change Server</button>
        </div>
    </div>

    <script src="sidepanel.js"></script>
</body>
</html>
